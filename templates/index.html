<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Assistente de E-mails Inteligente</title>
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <div class="chat-window">
    <h1>Assistente de E-mails ðŸ¤–</h1>
    <div id="chat-box"></div>
    <div class="input-area">
      <label for="file-input" class="file-icon-btn" title="Anexar arquivo">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="white" viewBox="0 0 24 24">
          <path d="M16.5 6.1v9.4c0 2.1-1.7 3.8-3.8 3.8S8.9 17.6 8.9 15.5V6.1c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v8.6c0 .6-.5 1.1-1.1 1.1s-1.1-.5-1.1-1.1V6.1H9.5v8.6c0 1.4 1.1 2.5 2.5 2.5s2.5-1.1 2.5-2.5V6.1c0-2.1-1.7-3.8-3.8-3.8S7.9 4 7.9 6.1v9.4c0 2.9 2.3 5.2 5.2 5.2s5.2-2.3 5.2-5.2V6.1h-1.8z"/>
        </svg>
      </label>
      <input type="file" id="file-input" accept=".txt,.pdf" style="display: none;" />
      <input type="text" id="user-input" placeholder="Digite sua mensagem..." />
      <button onclick="sendMessage()">Enviar</button>
    </div>
  </div>

  <script>
  async function sendMessage() {
    const input = document.getElementById("user-input");
    const fileInput = document.getElementById("file-input");
    const chatBox = document.getElementById("chat-box");

    // Se houver arquivo, priorize-o
    if (fileInput.files.length > 0) {
      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append("file", file);

      chatBox.innerHTML += `
        <div class="message user-message">
          <i class="fas fa-user avatar"></i>
          <div class="message-text">[Arquivo enviado: ${file.name}]</div>
        </div>`;

      const response = await fetch("/upload", {
        method: "POST",
        body: formData,
      });

      const data = await response.json();
      if (data.reply) {
        chatBox.innerHTML += `
          <div class="message ai-message">
            <i class="fas fa-robot avatar"></i>
            <div class="message-text">${data.reply}</div>
          </div>`;
      } else {
        chatBox.innerHTML += `<div class="ai-message error">Erro: ${data.error}</div>`;
      }

      fileInput.value = ""; // limpa o input de arquivo
    }

    // Caso contrÃ¡rio, texto digitado
    else if (input.value.trim() !== "") {
      const message = input.value.trim();
      chatBox.innerHTML += `
        <div class="message user-message">
          <i class="fas fa-user avatar"></i>
          <div class="message-text">${message}</div>
        </div>`;
      input.value = "";

      const response = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message }),
      });

      const data = await response.json();
      if (data.reply) {
        chatBox.innerHTML += `
          <div class="message ai-message">
            <i class="fas fa-robot avatar"></i>
            <div class="message-text">${data.reply}</div>
          </div>`;
      } else {
        chatBox.innerHTML += `<div class="ai-message error">Erro: ${data.error}</div>`;
      }
    }

    chatBox.scrollTop = chatBox.scrollHeight;
  }
  </script>

</body>
</html>
